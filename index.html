<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tic Tac Toe Online</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
</head>
<body class="bg-gray-900 text-white font-sans min-h-screen flex flex-col">
  <!-- Auth Screen -->
  <div id="auth-screen" class="flex-grow flex flex-col items-center justify-center">
    <h1 class="text-4xl font-bold mb-6">Tic Tac Toe Online</h1>
    <button onclick="signIn()" class="bg-blue-500 hover:bg-blue-600 px-6 py-3 rounded">Sign in with Google</button>
  </div>  <!-- Main App -->  <div id="app" class="hidden flex-grow flex flex-col">
    <!-- Top Bar -->
    <div class="p-4 flex justify-between items-center border-b border-gray-700">
      <div>
        <span id="username" class="font-semibold"></span>
        <span class="text-gray-400 ml-2">Rating: <span id="rating">0</span></span>
      </div>
      <div id="match-link" class="text-sm text-blue-400"></div>
    </div><!-- Screens Container -->
<div id="screens" class="flex-grow overflow-auto p-4">
  <!-- Home Screen -->
  <div id="screen-home" class="space-y-4">
    <button onclick="startMatching()" class="w-full bg-green-500 hover:bg-green-600 px-4 py-2 rounded">Play Online</button>
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50">
      <div class="bg-gray-800 p-6 rounded shadow-lg text-center">
        <p class="mb-4">Waiting for another player...</p>
        <div class="animate-spin rounded-full h-8 w-8 border-t-2 border-white mx-auto"></div>
      </div>
    </div>
    <div id="board" class="grid grid-cols-3 gap-2 mt-6 w-72 mx-auto hidden"></div>
    <p id="game-status" class="text-xl mt-4 font-bold text-center"></p>
  </div>

  <!-- Leaderboard Screen -->
  <div id="screen-leaderboard" class="hidden">
    <h2 class="text-2xl font-bold mb-4">Leaderboard</h2>
    <div id="leaderboard-list" class="space-y-2"></div>
  </div>

  <!-- Settings Screen -->
  <div id="screen-settings" class="hidden">
    <h2 class="text-2xl font-bold mb-4">Settings</h2>
    <button onclick="signOut()" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded">Sign Out</button>
  </div>
</div>

<!-- Bottom Navigation -->
<div class="border-t border-gray-700 flex justify-around p-2">
  <button onclick="showScreen('home')" class="flex-grow text-center py-2 hover:bg-gray-800 rounded">üè†<br>Home</button>
  <button onclick="showScreen('leaderboard')" class="flex-grow text-center py-2 hover:bg-gray-800 rounded">‚≠ê<br>Leaderboard</button>
  <button onclick="showScreen('settings')" class="flex-grow text-center py-2 hover:bg-gray-800 rounded">‚öôÔ∏è<br>Settings</button>
</div>

  </div><script>
  // Firebase Config
    
  const firebaseConfig = {
  apiKey: "AIzaSyBqC69KDh1LqCw1DnxP5KWLP302WImS18M",
  authDomain: "online-tic-tac-toe-726c2.firebaseapp.com",
  databaseURL: "https://online-tic-tac-toe-726c2-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "online-tic-tac-toe-726c2",
  storageBucket: "online-tic-tac-toe-726c2.firebasestorage.app",
  messagingSenderId: "668299566909",
  appId: "1:668299566909:web:d28ff050a0932452e96f54"
};
    

  
  
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  // UI Elements
  const authScreen = document.getElementById('auth-screen');
  const app = document.getElementById('app');
  const usernameEl = document.getElementById('username');
  const ratingEl = document.getElementById('rating');
  const boardEl = document.getElementById('board');
  const gameStatus = document.getElementById('game-status');
  const modal = document.getElementById('modal');
  const matchLinkEl = document.getElementById('match-link');

  let user, playerSymbol, gameId, turn, board = [];

  // Auth
  auth.onAuthStateChanged(async u => {
    if (u) {
      user = u;
      authScreen.classList.add('hidden');
      app.classList.remove('hidden');
      usernameEl.textContent = u.displayName;
      const userRef = db.ref('users/' + u.uid);
      const snap = await userRef.get();
      let rating = snap.child('rating').exists() ? snap.child('rating').val() : 1000;
      await userRef.update({ rating, displayName: u.displayName });
      ratingEl.textContent = rating;
      showScreen('home');
      loadLeaderboard();
      // If URL has code, show link and auto-match
      const existingCode = new URLSearchParams(window.location.search).get('match');
      if (existingCode) {
        matchLinkEl.innerHTML = `Link: <code>?match=${existingCode}</code>`;
      }
    }
  });

  function signIn() {
    auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
  }
  function signOut() {
    auth.signOut(); location.reload();
  }

  function showScreen(name) {
    ['home','leaderboard','settings'].forEach(s => document.getElementById('screen-'+s).classList.add('hidden'));
    document.getElementById('screen-'+name).classList.remove('hidden');
  }

  // Leaderboard
  async function loadLeaderboard() {
    const snap = await db.ref('users').orderByChild('rating').limitToLast(20).get();
    const list = [];
    snap.forEach(child => list.push({ name: child.val().displayName || 'User', rating: child.val().rating }));
    list.sort((a,b) => b.rating - a.rating);
    const container = document.getElementById('leaderboard-list');
    container.innerHTML = '';
    list.forEach((u,i) => {
      const card = document.createElement('div');
      const colors = ['bg-yellow-500', 'bg-gray-300 text-gray-900', 'bg-yellow-700'];
      const bg = i<3 ? colors[i] : 'bg-gray-800';
      card.className = `flex justify-between p-4 rounded ${bg}`;
      card.innerHTML = `<span>#${i+1}</span><span>${u.name}</span><span>${u.rating}</span>`;
      container.appendChild(card);
    });
  }

  // Matchmaking (URL-based)
  async function startMatching() {
    // generate or get code
    let code = new URLSearchParams(window.location.search).get('match');
    if (!code) {
      code = Math.floor(10000000 + Math.random()*90000000).toString();
      history.replaceState(null, '', '?match=' + code);
    }
    matchLinkEl.innerHTML = `Link: <code>?match=${code}</code>`;
    modal.classList.remove('hidden');

    const slotRef = db.ref(`matchSlots/${code}`);
    
    // join slot
    const snap = await slotRef.get();
    if (!snap.exists()) {
      await slotRef.set({ player1: user.uid });
      // listen for player2
      slotRef.on('value', async s2 => {
        const data = s2.val();
        if (data.player2 && data.player2 !== user.uid) {
          slotRef.off(); slotRef.remove();
          initGame(code, data.player2);
        }
      });
    } else if (snap.val().player1 !== user.uid) {
      await slotRef.update({ player2: user.uid });
      // immediate start
      initGame(code, snap.val().player1);
      slotRef.remove();
    }
  }

  async function initGame(code, opponentUid) {
    modal.classList.add('hidden');
    boardEl.classList.remove('hidden');
    gameId = code;
    const opponentSnap = await db.ref('users/' + opponentUid + '/displayName').get();
    gameStatus.textContent = 'Playing with ' + (opponentSnap.exists() ? opponentSnap.val() : 'Opponent');
    playerSymbol = user.uid < opponentUid ? 'X' : 'O';
    turn = 'X';
    board = Array(9).fill('');
    await db.ref('games/' + gameId).set({ board, turn });
    listenGame();
  }

  function listenGame() {
    db.ref('games/' + gameId).on('value', snap => {
      const d = snap.val(); if (!d) return;
      board = d.board; turn = d.turn;
      renderBoard();
      if (checkWin('X') || checkWin('O') || !board.includes('')) endGame();
    });
  }

  async function makeMove(i) {
    if (board[i] || turn !== playerSymbol) return;
    board[i] = playerSymbol;
    turn = turn === 'X' ? 'O' : 'X';
    await db.ref('games/' + gameId).update({ board, turn });
  }

  function renderBoard() {
    boardEl.innerHTML = '';
    board.forEach((c,i) => {
      const d = document.createElement('div');
      d.className = 'w-20 h-20 bg-gray-700 flex items-center justify-center text-3xl font-bold cursor-pointer';
      d.textContent = c;
      if (c === 'X') d.classList.add('text-red-500');
      if (c === 'O') d.classList.add('text-blue-500');
      if (!c && turn === playerSymbol) d.onclick = () => makeMove(i);
      boardEl.appendChild(d);
    });
  }

  function checkWin(p) {
    const w = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    return w.some(c => c.every(i => board[i] === p));
  }

  async function endGame() {
    db.ref('games/' + gameId).off();
    const xw = checkWin('X'), ow = checkWin('O');
    let msg = 'Draw';
    if (xw || ow) msg = ((xw && playerSymbol === 'X') || (ow && playerSymbol === 'O')) ? 'You Win!' : 'You Lose!';
    gameStatus.textContent = msg;
    const snap = await db.ref('users/' + user.uid + '/rating').get(); let r = snap.val();
    if (msg === 'You Win!') r += 12; else if (msg === 'You Lose!') r -= 4;
    await db.ref('users/' + user.uid + '/rating').set(r);
    ratingEl.textContent = r;
    setTimeout(() => { boardEl.classList.add('hidden'); gameStatus.textContent = ''; history.replaceState(null, '', ' '); }, 4000);
  }
</script></body>
</html>
